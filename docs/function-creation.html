<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Cours 22 Function creation | Utilisation_cluster_de_calcul</title>
  <meta name="description" content="Description." />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Cours 22 Function creation | Utilisation_cluster_de_calcul" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Description." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Cours 22 Function creation | Utilisation_cluster_de_calcul" />
  
  <meta name="twitter:description" content="Description." />
  

<meta name="author" content="Vincyane" />


<meta name="date" content="2025-04-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intégration-continue.html"/>
<link rel="next" href="package-creation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script async defer src="https://hypothes.is/embed.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">My_cours</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="divider"></li>
<li><a href="https://github.com/VincyaneBadouard/My_cours" target="blank">Source</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Utilisation_cluster_de_calcul</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div class = rmdreview>
This book is in <b><a href="open.html#open">Open Review</a></b>. I want your feedback to make the book better for you and other readers. To add your annotation, <span style="background-color: #3297FD; color: white">select some text</span> and then click the <i class="h-icon-annotate"></i> on the pop-up menu. To see the annotations of others, click the <i class="h-icon-chevron-left"></i> in the upper right hand corner of the page <i class="fa fa-arrow-circle-right  fa-rotate-315" aria-hidden="true"></i>
</div>
<div id="function-creation" class="section level1 hasAnchor" number="22">
<h1><span class="header-section-number">Cours 22</span> Function creation<a href="function-creation.html#function-creation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="étapes-de-développement" class="section level2 hasAnchor" number="22.1">
<h2><span class="header-section-number">22.1</span> Étapes de développement :<a href="function-creation.html#étapes-de-développement" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Planifier le travail (pas de programmation encore) :</li>
</ol>
<ul>
<li>définir clairement la tâche à accomplir par la fonction et la sortie qu’elle doit produire,</li>
<li>prévoir les étapes à suivre afin d’effectuer cette tâche,</li>
<li>identifier les arguments devant être fournis en entrée à la fonction.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Développer le corps de la fonction</li>
</ol>
<ul>
<li>Écrire le programme par étapes, d’abord sans former la fonction, en commentant bien le code et en travaillant sur des mini-données test.</li>
<li>Pour chaque petite étape ou sous-tâche, tester interactivement si le programme produit le résultat escompté (tester souvent en cours de travail, ainsi il y a moins de débogage à faire).</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p>Créer la fonction à partir du programme développé.</p></li>
<li><p>Documenter la fonction.</p></li>
<li><p>Tester la fonction : sauvegarder nos tests et bien les structurer, car ils serviront souvent.</p></li>
<li><p>Si nous rencontrons des comportements indésirables lors des tests, déboguer la fonction :</p></li>
</ol>
<ul>
<li>cerner le ou les problèmes,</li>
<li>apporter les correctifs nécessaires à la fonction (que ce soit dans son corps ou dans liste de ses arguments),</li>
<li>adapter la documentation et les tests au besoin,</li>
<li>faire tourner de nouveau les tests,</li>
<li>répéter ces sous-étapes jusqu’à ce que les tests ne révèlent plus aucun problème à régler ou aucune amélioration à apporter.</li>
</ul>
</div>
<div id="structure" class="section level2 hasAnchor" number="22.2">
<h2><span class="header-section-number">22.2</span> Structure :<a href="function-creation.html#structure" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="function-creation.html#cb82-1" tabindex="-1"></a>nomdemafonction<span class="ot">&lt;-</span><span class="cf">function</span>(variable1,variable2...)</span>
<span id="cb82-2"><a href="function-creation.html#cb82-2" tabindex="-1"></a>{</span>
<span id="cb82-3"><a href="function-creation.html#cb82-3" tabindex="-1"></a>  <span class="co">#ici on met le contenu de la fonction (généralement on effectue des transformations aux variables passées en argument)</span></span>
<span id="cb82-4"><a href="function-creation.html#cb82-4" tabindex="-1"></a>  </span>
<span id="cb82-5"><a href="function-creation.html#cb82-5" tabindex="-1"></a>  </span>
<span id="cb82-6"><a href="function-creation.html#cb82-6" tabindex="-1"></a>  </span>
<span id="cb82-7"><a href="function-creation.html#cb82-7" tabindex="-1"></a>  </span>
<span id="cb82-8"><a href="function-creation.html#cb82-8" tabindex="-1"></a>  </span>
<span id="cb82-9"><a href="function-creation.html#cb82-9" tabindex="-1"></a>  <span class="fu">return</span>(Variabledesortie) <span class="do">## il s&#39;agit du résultat que va renvoyer la fonction (non négligeable!)! c&#39;est bien le but d&#39;une fct!</span></span>
<span id="cb82-10"><a href="function-creation.html#cb82-10" tabindex="-1"></a>}</span>
<span id="cb82-11"><a href="function-creation.html#cb82-11" tabindex="-1"></a></span>
<span id="cb82-12"><a href="function-creation.html#cb82-12" tabindex="-1"></a><span class="co">#une fois la fonction créée on peut l&#39;utiliser:</span></span>
<span id="cb82-13"><a href="function-creation.html#cb82-13" tabindex="-1"></a><span class="fu">nomdemafonction</span>(varA,varB,...)</span></code></pre></div>
<p><em>Une fct normalement constituée ne travaille directement que sur ses arguments et non sur les objets stockés dans la console.</em>
Tous les objets qui seront utilisés dans le script doivent avoir été créés dans le script.
Les seules exceptions à cette règle sont les arguments qui eux sont définis dans l’en-tête.</p>
<p>Exemple</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="function-creation.html#cb83-1" tabindex="-1"></a><span class="do">## Calculer le coefficient de variation (CV) (=écart type/moyenne) d&#39;une série de valeur.</span></span>
<span id="cb83-2"><a href="function-creation.html#cb83-2" tabindex="-1"></a></span>
<span id="cb83-3"><a href="function-creation.html#cb83-3" tabindex="-1"></a></span>
<span id="cb83-4"><a href="function-creation.html#cb83-4" tabindex="-1"></a></span>
<span id="cb83-5"><a href="function-creation.html#cb83-5" tabindex="-1"></a>cv <span class="ot">&lt;-</span> <span class="cf">function</span>(x){      <span class="do">## x est un vecteur contenant une série de valeurs</span></span>
<span id="cb83-6"><a href="function-creation.html#cb83-6" tabindex="-1"></a>  moy <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)        <span class="do">## moyenne de x</span></span>
<span id="cb83-7"><a href="function-creation.html#cb83-7" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">sd</span>(x)            <span class="do">## ecart type de x</span></span>
<span id="cb83-8"><a href="function-creation.html#cb83-8" tabindex="-1"></a>  rslt <span class="ot">&lt;-</span> s<span class="sc">/</span>moy         <span class="do">## calcul du CV</span></span>
<span id="cb83-9"><a href="function-creation.html#cb83-9" tabindex="-1"></a>  rslt                  <span class="co">#la fonction retourne le résultat</span></span>
<span id="cb83-10"><a href="function-creation.html#cb83-10" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="nommer-ses-arguments" class="section level2 hasAnchor" number="22.3">
<h2><span class="header-section-number">22.3</span> Nommer ses arguments<a href="function-creation.html#nommer-ses-arguments" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Noms habituels :
x, y, z: vectors.
w: a vector of weights.
df: a data frame.
i, j: numeric indices (typically rows and columns).
n: length, or number of rows.
p: number of columns.</p>
<p>Règle :
Si les <em>arguments</em> des fonctions appelées sont donnés de la forme <em>name = object</em>, ils peuvent être écris dans n’importe quel ordre. Dans le cas contraire, il faut respecter l’ordre des arguments.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="function-creation.html#cb84-1" tabindex="-1"></a>fun1 <span class="ot">&lt;-</span> <span class="cf">function</span>(data, data.frame, graph, limit) {</span>
<span id="cb84-2"><a href="function-creation.html#cb84-2" tabindex="-1"></a>  [<span class="cf">function</span> body omitted]</span>
<span id="cb84-3"><a href="function-creation.html#cb84-3" tabindex="-1"></a>}</span>
<span id="cb84-4"><a href="function-creation.html#cb84-4" tabindex="-1"></a></span>
<span id="cb84-5"><a href="function-creation.html#cb84-5" tabindex="-1"></a><span class="do">## Alors la fonction peut être invoquée de plusieurs manières, par exemple:</span></span>
<span id="cb84-6"><a href="function-creation.html#cb84-6" tabindex="-1"></a></span>
<span id="cb84-7"><a href="function-creation.html#cb84-7" tabindex="-1"></a>ans <span class="ot">&lt;-</span> <span class="fu">fun1</span>(d, df, <span class="cn">TRUE</span>, <span class="dv">20</span>) <span class="do">## arguments dans l&#39;ordre</span></span>
<span id="cb84-8"><a href="function-creation.html#cb84-8" tabindex="-1"></a>ans <span class="ot">&lt;-</span> <span class="fu">fun1</span>(<span class="at">data=</span>d, <span class="at">limit=</span><span class="dv">20</span>, <span class="at">graph=</span><span class="cn">TRUE</span>, <span class="at">data.frame=</span>df) <span class="do">## arguments dans le désordre et donc nommés</span></span></code></pre></div>
</div>
<div id="valeurs-par-défaut" class="section level2 hasAnchor" number="22.4">
<h2><span class="header-section-number">22.4</span> Valeurs par défaut<a href="function-creation.html#valeurs-par-défaut" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="function-creation.html#cb85-1" tabindex="-1"></a>fun1 <span class="ot">&lt;-</span> <span class="cf">function</span>(data, data.frame, <span class="at">graph=</span><span class="cn">TRUE</span>, <span class="at">limit=</span><span class="dv">20</span>) { ... } <span class="co">#on attribue une valeur à l&#39;argument dès l&#39;écriture</span></span></code></pre></div>
</div>
<div id="évaluation-de-la-fonction" class="section level2 hasAnchor" number="22.5">
<h2><span class="header-section-number">22.5</span> évaluation de la fonction<a href="function-creation.html#évaluation-de-la-fonction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>return() renvoie la dernière valeur calculée</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="function-creation.html#cb86-1" tabindex="-1"></a>nom_de_fonction <span class="ot">&lt;-</span> <span class="cf">function</span>(arguments) {</span>
<span id="cb86-2"><a href="function-creation.html#cb86-2" tabindex="-1"></a>  instructions</span>
<span id="cb86-3"><a href="function-creation.html#cb86-3" tabindex="-1"></a>  <span class="fu">return</span>(valeur) <span class="co">#non négligeable! c&#39;est bien le but d&#39;une fct!</span></span>
<span id="cb86-4"><a href="function-creation.html#cb86-4" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="vérification-de-la-classe-des-arguments" class="section level2 hasAnchor" number="22.6">
<h2><span class="header-section-number">22.6</span> Vérification de la classe des arguments<a href="function-creation.html#vérification-de-la-classe-des-arguments" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="function-creation.html#cb87-1" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
</div>
<div id="largument-fun" class="section level2 hasAnchor" number="22.7">
<h2><span class="header-section-number">22.7</span> L’argument ‘fun’<a href="function-creation.html#largument-fun" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>= passer une fonction a une autre fonction en argument</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="function-creation.html#cb88-1" tabindex="-1"></a>col_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(df, fun) {</span>
<span id="cb88-2"><a href="function-creation.html#cb88-2" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="fu">length</span>(df))</span>
<span id="cb88-3"><a href="function-creation.html#cb88-3" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(df)) {</span>
<span id="cb88-4"><a href="function-creation.html#cb88-4" tabindex="-1"></a>    out[i] <span class="ot">&lt;-</span> <span class="fu">fun</span>(df[[i]])</span>
<span id="cb88-5"><a href="function-creation.html#cb88-5" tabindex="-1"></a>  }</span>
<span id="cb88-6"><a href="function-creation.html#cb88-6" tabindex="-1"></a>  out</span>
<span id="cb88-7"><a href="function-creation.html#cb88-7" tabindex="-1"></a>}</span>
<span id="cb88-8"><a href="function-creation.html#cb88-8" tabindex="-1"></a><span class="fu">col_summary</span>(df, median)</span>
<span id="cb88-9"><a href="function-creation.html#cb88-9" tabindex="-1"></a><span class="fu">col_summary</span>(df, mean)</span></code></pre></div>
</div>
<div id="largument" class="section level2 hasAnchor" number="22.8">
<h2><span class="header-section-number">22.8</span> L’argument ‘…’<a href="function-creation.html#largument" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Il est possible d’utiliser le symbole ‘…’ (ellipsis) dans les paramètres d’une fct pour indiquer que tous les paramètres supplémentaires seront transmis aux autres fonctions internes.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="function-creation.html#cb89-1" tabindex="-1"></a>fun1 <span class="ot">&lt;-</span> <span class="cf">function</span>(data, data.frame, <span class="at">graph=</span><span class="cn">TRUE</span>, <span class="at">limit=</span><span class="dv">20</span>, ...) {</span>
<span id="cb89-2"><a href="function-creation.html#cb89-2" tabindex="-1"></a>  [omitted statements]</span>
<span id="cb89-3"><a href="function-creation.html#cb89-3" tabindex="-1"></a>  <span class="cf">if</span> (graph)</span>
<span id="cb89-4"><a href="function-creation.html#cb89-4" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">pch=</span><span class="st">&quot;*&quot;</span>, ...)</span>
<span id="cb89-5"><a href="function-creation.html#cb89-5" tabindex="-1"></a>  [more omissions]</span>
<span id="cb89-6"><a href="function-creation.html#cb89-6" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="types-de-fonction" class="section level2 hasAnchor" number="22.9">
<h2><span class="header-section-number">22.9</span> Types de fonction<a href="function-creation.html#types-de-fonction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="appel-récursif" class="section level3 hasAnchor" number="22.9.1">
<h3><span class="header-section-number">22.9.1</span> Appel récursif<a href="function-creation.html#appel-récursif" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La récursivité est une démarche qui fait référence à l’objet-même de la démarche à un moment du processus (=poupée russe)
Une fct peut s’appeller elle-même, tant qu’il existe une condition d’arrêt.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="function-creation.html#cb90-1" tabindex="-1"></a><span class="do">## Scalaire : nombre réel</span></span>
<span id="cb90-2"><a href="function-creation.html#cb90-2" tabindex="-1"></a><span class="do">## Vecteur : serie de valeurs</span></span>
<span id="cb90-3"><a href="function-creation.html#cb90-3" tabindex="-1"></a></span>
<span id="cb90-4"><a href="function-creation.html#cb90-4" tabindex="-1"></a><span class="do">## Sur scalaire</span></span>
<span id="cb90-5"><a href="function-creation.html#cb90-5" tabindex="-1"></a>factorielle <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb90-6"><a href="function-creation.html#cb90-6" tabindex="-1"></a>  <span class="cf">if</span> (n<span class="sc">==</span><span class="dv">1</span>) resultat <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="do">## scalaire booléen       ## arrêt de la récursion (n=1 est la condition d&#39;arrêt)</span></span>
<span id="cb90-7"><a href="function-creation.html#cb90-7" tabindex="-1"></a>  <span class="cf">else</span> resultat <span class="ot">&lt;-</span> <span class="fu">factorielle</span>(n<span class="dv">-1</span>)<span class="sc">*</span>n <span class="do">## appel récursif (si n différent de 1)</span></span>
<span id="cb90-8"><a href="function-creation.html#cb90-8" tabindex="-1"></a>  <span class="fu">return</span>(resultat)</span>
<span id="cb90-9"><a href="function-creation.html#cb90-9" tabindex="-1"></a>}</span>
<span id="cb90-10"><a href="function-creation.html#cb90-10" tabindex="-1"></a><span class="do">## Sur vecteur</span></span>
<span id="cb90-11"><a href="function-creation.html#cb90-11" tabindex="-1"></a>factorielle <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb90-12"><a href="function-creation.html#cb90-12" tabindex="-1"></a>  indice <span class="ot">&lt;-</span> (n <span class="sc">==</span> <span class="dv">1</span>) <span class="do">## vecteur de booléens</span></span>
<span id="cb90-13"><a href="function-creation.html#cb90-13" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(indice)) <span class="fu">return</span>(n) <span class="do">## arrêt de la récursion (n=1 est la condition d&#39;arrêt)</span></span>
<span id="cb90-14"><a href="function-creation.html#cb90-14" tabindex="-1"></a>  n[<span class="sc">!</span>indice] <span class="ot">&lt;-</span> n[<span class="sc">!</span>indice]<span class="sc">*</span><span class="fu">factorielle</span>(n[<span class="sc">!</span>indice] <span class="sc">-</span> <span class="dv">1</span>) <span class="do">## appel récursif (si n différent de 1)</span></span>
<span id="cb90-15"><a href="function-creation.html#cb90-15" tabindex="-1"></a>  <span class="fu">return</span>(n)</span>
<span id="cb90-16"><a href="function-creation.html#cb90-16" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="fct-anonyme-dans-une-autre-fonction" class="section level3 hasAnchor" number="22.9.2">
<h3><span class="header-section-number">22.9.2</span> Fct anonyme dans une autre fonction<a href="function-creation.html#fct-anonyme-dans-une-autre-fonction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="function-creation.html#cb91-1" tabindex="-1"></a><span class="fu">outer</span>(x, y, <span class="cf">function</span>(x, y) x <span class="sc">*</span> y<span class="sc">^</span><span class="dv">2</span>) <span class="do">## une fonction est mise en argument d&#39;une autre fonction</span></span>
<span id="cb91-2"><a href="function-creation.html#cb91-2" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3]</span></span>
<span id="cb91-3"><a href="function-creation.html#cb91-3" tabindex="-1"></a><span class="do">## [1,]   16   25   36</span></span>
<span id="cb91-4"><a href="function-creation.html#cb91-4" tabindex="-1"></a><span class="do">## [2,]   32   50   72</span></span>
<span id="cb91-5"><a href="function-creation.html#cb91-5" tabindex="-1"></a><span class="do">## [3,]   48   75  108</span></span></code></pre></div>
</div>
</div>
<div id="retourner-un-résultat" class="section level2 hasAnchor" number="22.10">
<h2><span class="header-section-number">22.10</span> Retourner un résultat<a href="function-creation.html#retourner-un-résultat" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Une fonction retourne le <em>résultat de la dernière expression</em> du corps de la fct.
-&gt; donc il ne faut pas que la dernère expression soit une affectation (&lt;-), sinon on ne pourra pas affecter le résultat à un objet</p></li>
<li><p>On peut retourner un résultat spécifique, à n’importe quel endroit de la fonction avec la fct <em>return()</em>
Si le résultat que l’on veut retourner est codé par la dernière expression, return() est inutile.
“return” se met plutot à la fin d’une fct, sauf cas exeptionel (if…), car la fct n’affiche plus les msg/stop si le return s’est effectué.</p></li>
<li><p>Lorsqu’une fonction doit retourner plusieurs résultats, il est en général préférable d’avoir recours à une <em>liste nommée</em>.</p></li>
<li><p>Retourner plsrs outputs : <em>Outputs &lt;- list(objt1 = objt1, objt2 = objt2) return(Outputs)</em></p></li>
</ul>
<p><em>Si une fct retourne plsrs ouputs, elle doit toujours les retourner. S’il ne sont générés que sous condition, créer un objet vide du m^me nom lorsque la condition n’est pas respectée.</em></p>
</div>
<div id="fonctions-de-message-et-darrêt-de-fonction" class="section level2 hasAnchor" number="22.11">
<h2><span class="header-section-number">22.11</span> Fonctions de message et d’arrêt de fonction<a href="function-creation.html#fonctions-de-message-et-darrêt-de-fonction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>message() = message diagnostique (juste informatif)</li>
<li>warning() = message d’erreur (problème non rédhibitoire (ex: syntax))</li>
<li>stop() = message d’erreur + arrêt du code (rédhibitoire)</li>
</ul>
<p>“stop” est une fonction d’erreur, si c’est juste une question de prérequis, il faut utiliser “if” pas “stop”.
Un “stop” dans une fonction interne arrête également la fonction dans laquelle elle est inscrite.</p>
<p>“try” : essaye la fonction interne sans stopper la fonction englobante.
“catch” : capture le résultat du “try” quel qu’il soit.</p>
<ul>
<li><p><em>verbose</em> : par défaut = TRUE dans R donc si on veut tjrs tout afficher il ne sert à rien de le mentionner</p></li>
<li><p>Pour demander confirmation à l’utilisateur : <em>readline(“pay attention to me!(press enter to continue)”)</em></p></li>
</ul>
</div>
<div id="interaction-avec-lutilisateur" class="section level2 hasAnchor" number="22.12">
<h2><span class="header-section-number">22.12</span> Interaction avec l’utilisateur<a href="function-creation.html#interaction-avec-lutilisateur" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="function-creation.html#cb92-1" tabindex="-1"></a>fun <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb92-2"><a href="function-creation.html#cb92-2" tabindex="-1"></a>  ANSWER <span class="ot">&lt;-</span> <span class="fu">readline</span>(<span class="st">&quot;Are you a satisfied R user? &quot;</span>) <span class="do">## question</span></span>
<span id="cb92-3"><a href="function-creation.html#cb92-3" tabindex="-1"></a>  </span>
<span id="cb92-4"><a href="function-creation.html#cb92-4" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">substr</span>(ANSWER, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">==</span> <span class="st">&quot;n&quot;</span>) <span class="do">## check the answer</span></span>
<span id="cb92-5"><a href="function-creation.html#cb92-5" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;This is impossible.  YOU LIED!</span><span class="sc">\n</span><span class="st">&quot;</span>) <span class="do">## re-prompt</span></span>
<span id="cb92-6"><a href="function-creation.html#cb92-6" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb92-7"><a href="function-creation.html#cb92-7" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;I knew it.</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb92-8"><a href="function-creation.html#cb92-8" tabindex="-1"></a>}</span>
<span id="cb92-9"><a href="function-creation.html#cb92-9" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">interactive</span>()) <span class="fu">fun</span>()</span></code></pre></div>
</div>
<div id="iteration" class="section level2 hasAnchor" number="22.13">
<h2><span class="header-section-number">22.13</span> Iteration<a href="function-creation.html#iteration" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://r4ds.had.co.nz/iteration.html" class="uri">https://r4ds.had.co.nz/iteration.html</a></p>
<ul>
<li>itérer n fois : <em>replicate(n, expr, simplify = F)</em> (renvoie une liste) ou <em>purrr::rerun(n, expr)</em> ou <em>purrr::map(1:n, ~ expr)</em> ou <em>lapply(seq_len(n), function(x) fun())</em></li>
</ul>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="function-creation.html#cb93-1" tabindex="-1"></a><span class="do">## fun0 a function</span></span>
<span id="cb93-2"><a href="function-creation.html#cb93-2" tabindex="-1"></a><span class="do">## fun1 a a function to iterate fun0 with a n argument</span></span>
<span id="cb93-3"><a href="function-creation.html#cb93-3" tabindex="-1"></a>fun1 <span class="ot">&lt;-</span> <span class="cf">function</span>(n, x) <span class="fu">replicate</span>(n, <span class="fu">fun0</span>(<span class="at">x =</span> x))</span>
<span id="cb93-4"><a href="function-creation.html#cb93-4" tabindex="-1"></a><span class="fu">fun1</span>(n, x)</span></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="function-creation.html#cb94-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb94-2"><a href="function-creation.html#cb94-2" tabindex="-1"></a>fun0 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">as.list</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)), <span class="at">nrow =</span> <span class="dv">2</span>))</span>
<span id="cb94-3"><a href="function-creation.html#cb94-3" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb94-4"><a href="function-creation.html#cb94-4" tabindex="-1"></a><span class="fu">fun0</span>(<span class="dv">1</span>)</span>
<span id="cb94-5"><a href="function-creation.html#cb94-5" tabindex="-1"></a></span>
<span id="cb94-6"><a href="function-creation.html#cb94-6" tabindex="-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb94-7"><a href="function-creation.html#cb94-7" tabindex="-1"></a></span>
<span id="cb94-8"><a href="function-creation.html#cb94-8" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(</span>
<span id="cb94-9"><a href="function-creation.html#cb94-9" tabindex="-1"></a>  <span class="at">repl =</span> {<span class="fu">replicate</span>(n, <span class="fu">fun0</span>(<span class="dv">1</span>), <span class="at">simplify =</span> <span class="cn">FALSE</span>)},</span>
<span id="cb94-10"><a href="function-creation.html#cb94-10" tabindex="-1"></a>  <span class="at">reru =</span> {purrr<span class="sc">::</span><span class="fu">rerun</span>(n, <span class="fu">fun0</span>(<span class="dv">1</span>))},</span>
<span id="cb94-11"><a href="function-creation.html#cb94-11" tabindex="-1"></a>  <span class="at">map =</span> {purrr<span class="sc">::</span><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="sc">~</span><span class="fu">fun0</span>(<span class="dv">1</span>))},</span>
<span id="cb94-12"><a href="function-creation.html#cb94-12" tabindex="-1"></a>  <span class="at">lap =</span> {<span class="fu">lapply</span>(<span class="fu">seq_len</span>(n), <span class="cf">function</span>(x) <span class="fu">fun0</span>(<span class="dv">1</span>))},</span>
<span id="cb94-13"><a href="function-creation.html#cb94-13" tabindex="-1"></a>  <span class="at">times =</span> <span class="dv">1000</span><span class="dt">L</span></span>
<span id="cb94-14"><a href="function-creation.html#cb94-14" tabindex="-1"></a>)</span>
<span id="cb94-15"><a href="function-creation.html#cb94-15" tabindex="-1"></a></span>
<span id="cb94-16"><a href="function-creation.html#cb94-16" tabindex="-1"></a>mb</span>
<span id="cb94-17"><a href="function-creation.html#cb94-17" tabindex="-1"></a></span>
<span id="cb94-18"><a href="function-creation.html#cb94-18" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(</span>
<span id="cb94-19"><a href="function-creation.html#cb94-19" tabindex="-1"></a>  <span class="at">suit =</span> {<span class="dv">1</span><span class="sc">:</span>n},</span>
<span id="cb94-20"><a href="function-creation.html#cb94-20" tabindex="-1"></a>  <span class="at">rep =</span> {<span class="fu">rep</span>(<span class="dv">1</span>, n)},</span>
<span id="cb94-21"><a href="function-creation.html#cb94-21" tabindex="-1"></a>  <span class="at">seq_len =</span> {<span class="fu">seq_len</span>(n)},</span>
<span id="cb94-22"><a href="function-creation.html#cb94-22" tabindex="-1"></a>  <span class="at">seq_along =</span> {<span class="fu">seq_along</span> (n)}, <span class="do">## le + rapide</span></span>
<span id="cb94-23"><a href="function-creation.html#cb94-23" tabindex="-1"></a>  <span class="at">c =</span> {<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>n)},</span>
<span id="cb94-24"><a href="function-creation.html#cb94-24" tabindex="-1"></a>  <span class="at">times =</span> <span class="dv">1000</span><span class="dt">L</span></span>
<span id="cb94-25"><a href="function-creation.html#cb94-25" tabindex="-1"></a>)</span>
<span id="cb94-26"><a href="function-creation.html#cb94-26" tabindex="-1"></a></span>
<span id="cb94-27"><a href="function-creation.html#cb94-27" tabindex="-1"></a>mb</span></code></pre></div>
<ul>
<li>repeat() : répète à l’infini si on ne met pas une condition et un break dedans.</li>
<li>Boucle for ou boucle while</li>
<li>Encapsuler une boucle dans une fonction</li>
<li><em>apply</em> family (base) : apply(), lapply(), tapply(), etc</li>
<li><em>map</em> family (purrr) (+ rapides car écrite en C): map() (makes a list), map_lgl() (logical vector), map_int() (integer vector), map_dbl() (double vector), map_chr() (character vector).
Les map ne produisent que des vecteurs, pas de matrice)
Peuvent apliquer des fonctions ou des formules (<a href="https://r4ds.had.co.nz/iteration.html" class="uri">https://r4ds.had.co.nz/iteration.html</a>).</li>
</ul>
<p>Les boucles for ne sont plus lentes depuis de nombreuses années. Le principal avantage de l’utilisation de fonctions comme map() n’est pas la vitesse, mais la clarté : elles rendent votre code plus facile à écrire et à lire.</p>
<ul>
<li>Modif de l’output : transposer une liste (inverser la tructure) : purrr::transpose()</li>
</ul>
</div>
<div id="parallelisation-1" class="section level2 hasAnchor" number="22.14">
<h2><span class="header-section-number">22.14</span> Parallelisation<a href="function-creation.html#parallelisation-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://nceas.github.io/oss-lessons/parallel-computing-in-r/parallel-computing-in-r.html" class="uri">https://nceas.github.io/oss-lessons/parallel-computing-in-r/parallel-computing-in-r.html</a>
<a href="https://bookdown.org/rdpeng/rprogdatascience/parallel-computation.html" class="uri">https://bookdown.org/rdpeng/rprogdatascience/parallel-computation.html</a></p>
<p>Why : for time and memory</p>
<p>1 processor = multiple cores = multiple computations to be executed at the same time.
R is sequential and uses 1 processor</p>
<p>Plus simple de paralléliser des taches indépendantes, 1 par coeur.
1 tâche = 1 fct</p>
<ul>
<li>Packages : <em>parallel</em>, <em>future</em>, <em>foreach</em>, <em>doParallel</em></li>
<li>diffèrent selon les syst d’exploit on dirait</li>
</ul>
<p><em>Parallel</em> functions :
- detectCores() : détecte le nbr de coeur de la machine.
- mclapply() : utiliser plsrs coeurs sur un ordinateur local (= parallelized version of lapply) (pas sous windows)
- makeCluster() and clusterApply() : utiliser plusieurs processeurs sur des machines locales (et distantes)
- clusterExport() : à distance</p>
<p>Sous windows on ne peut pas paralléliser en local il faut donc un cluster :
- créer un cluster : <em>cl &lt;- makePSOCKcluster(nbr de copies de R à créer)</em> (à défaut d’avoir des coeurs il crée plsrs copies de R)
- créer l’envmt du cluster : <em>clusterExport(cl, varlist = c(“var1”, “var2”), envir = environment())</em>
- paralléliser : <em>parLapply(cl, seq_along(iter), myfun)</em>
- arrêter le cluster : <em>stopCluster(cl)</em></p>
<p><a href="https://stackoverflow.com/questions/17196261/understanding-the-differences-between-mclapply-and-parlapply-in-r" class="uri">https://stackoverflow.com/questions/17196261/understanding-the-differences-between-mclapply-and-parlapply-in-r</a></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="function-creation.html#cb95-1" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb95-2"><a href="function-creation.html#cb95-2" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makePSOCKcluster</span>(<span class="dv">4</span>) <span class="do">## créer un cluster</span></span>
<span id="cb95-3"><a href="function-creation.html#cb95-3" tabindex="-1"></a>myfun <span class="ot">&lt;-</span> <span class="cf">function</span>(i) { <span class="fu">Sys.sleep</span>(<span class="dv">1</span>); i } <span class="do">## the function</span></span>
<span id="cb95-4"><a href="function-creation.html#cb95-4" tabindex="-1"></a><span class="fu">parLapply</span>(cl, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, myfun) <span class="do">## parallelization</span></span>
<span id="cb95-5"><a href="function-creation.html#cb95-5" tabindex="-1"></a><span class="fu">stopCluster</span>(cl) <span class="do">## stop the cluster</span></span></code></pre></div>
<p>Sur des boucles :
- foreach sequential operator : <em>%do%</em>
- doParallel parallelizable operator : <em>%dopar%</em></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="function-creation.html#cb96-1" tabindex="-1"></a><span class="do">## nonparallel for loop</span></span>
<span id="cb96-2"><a href="function-creation.html#cb96-2" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb96-3"><a href="function-creation.html#cb96-3" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">sqrt</span>(i))</span>
<span id="cb96-4"><a href="function-creation.html#cb96-4" tabindex="-1"></a>}</span>
<span id="cb96-5"><a href="function-creation.html#cb96-5" tabindex="-1"></a><span class="do">## nonparallel foreach loop</span></span>
<span id="cb96-6"><a href="function-creation.html#cb96-6" tabindex="-1"></a><span class="fu">library</span>(foreach)</span>
<span id="cb96-7"><a href="function-creation.html#cb96-7" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb96-8"><a href="function-creation.html#cb96-8" tabindex="-1"></a>  <span class="fu">foreach</span> (<span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">.combine=</span>c) <span class="sc">%do%</span> { <span class="do">## .combine=c si on veut unlist l&#39;output, .combine=rbind si on veut un df </span></span>
<span id="cb96-9"><a href="function-creation.html#cb96-9" tabindex="-1"></a>    <span class="fu">sqrt</span>(i)</span>
<span id="cb96-10"><a href="function-creation.html#cb96-10" tabindex="-1"></a>  }</span>
<span id="cb96-11"><a href="function-creation.html#cb96-11" tabindex="-1"></a>})</span>
<span id="cb96-12"><a href="function-creation.html#cb96-12" tabindex="-1"></a><span class="do">## doParallel = foreach parallel adaptor for the &#39;parallel&#39; package</span></span>
<span id="cb96-13"><a href="function-creation.html#cb96-13" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb96-14"><a href="function-creation.html#cb96-14" tabindex="-1"></a>numCores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>(<span class="at">logical =</span> <span class="cn">FALSE</span>) <span class="do">## FALSE to have the physical cores</span></span>
<span id="cb96-15"><a href="function-creation.html#cb96-15" tabindex="-1"></a></span>
<span id="cb96-16"><a href="function-creation.html#cb96-16" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb96-17"><a href="function-creation.html#cb96-17" tabindex="-1"></a>  <span class="fu">registerDoParallel</span>(numCores)</span>
<span id="cb96-18"><a href="function-creation.html#cb96-18" tabindex="-1"></a>  <span class="fu">foreach</span> (<span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb96-19"><a href="function-creation.html#cb96-19" tabindex="-1"></a>    <span class="fu">sqrt</span>(i)</span>
<span id="cb96-20"><a href="function-creation.html#cb96-20" tabindex="-1"></a>  }</span>
<span id="cb96-21"><a href="function-creation.html#cb96-21" tabindex="-1"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="function-creation.html#cb97-1" tabindex="-1"></a><span class="co"># with foreach</span></span>
<span id="cb97-2"><a href="function-creation.html#cb97-2" tabindex="-1"></a>cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>()</span>
<span id="cb97-3"><a href="function-creation.html#cb97-3" tabindex="-1"></a>j <span class="ot">=</span> <span class="fu">length</span>(lases)</span>
<span id="cb97-4"><a href="function-creation.html#cb97-4" tabindex="-1"></a></span>
<span id="cb97-5"><a href="function-creation.html#cb97-5" tabindex="-1"></a><span class="co"># Create clusters</span></span>
<span id="cb97-6"><a href="function-creation.html#cb97-6" tabindex="-1"></a>cl <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(cores)</span>
<span id="cb97-7"><a href="function-creation.html#cb97-7" tabindex="-1"></a>doSNOW<span class="sc">::</span><span class="fu">registerDoSNOW</span>(cl)</span>
<span id="cb97-8"><a href="function-creation.html#cb97-8" tabindex="-1"></a></span>
<span id="cb97-9"><a href="function-creation.html#cb97-9" tabindex="-1"></a><span class="co"># Progressbar</span></span>
<span id="cb97-10"><a href="function-creation.html#cb97-10" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">interactive</span>()) pb <span class="ot">&lt;-</span> <span class="fu">txtProgressBar</span>(<span class="at">max =</span> j, <span class="at">style =</span> <span class="dv">3</span>) <span class="co"># if(interactive()) pour qu’elles n’apparaissent pas dans les documents markdown </span></span>
<span id="cb97-11"><a href="function-creation.html#cb97-11" tabindex="-1"></a>progress <span class="ot">&lt;-</span> <span class="cf">function</span>(n) <span class="cf">if</span>(<span class="fu">interactive</span>()) <span class="fu">setTxtProgressBar</span>(pb, n)</span>
<span id="cb97-12"><a href="function-creation.html#cb97-12" tabindex="-1"></a>opts <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">progress =</span> progress)</span>
<span id="cb97-13"><a href="function-creation.html#cb97-13" tabindex="-1"></a></span>
<span id="cb97-14"><a href="function-creation.html#cb97-14" tabindex="-1"></a><span class="co"># The loop</span></span>
<span id="cb97-15"><a href="function-creation.html#cb97-15" tabindex="-1"></a>output <span class="ot">&lt;-</span> foreach<span class="sc">::</span><span class="fu">foreach</span>(</span>
<span id="cb97-16"><a href="function-creation.html#cb97-16" tabindex="-1"></a>  <span class="at">i=</span><span class="dv">1</span><span class="sc">:</span>j,</span>
<span id="cb97-17"><a href="function-creation.html#cb97-17" tabindex="-1"></a>  <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">&quot;magrittr&quot;</span>), <span class="at">.options.snow =</span> opts</span>
<span id="cb97-18"><a href="function-creation.html#cb97-18" tabindex="-1"></a>) <span class="sc">%dopar%</span> {</span>
<span id="cb97-19"><a href="function-creation.html#cb97-19" tabindex="-1"></a>  <span class="fu">print</span>(i) <span class="co"># to debug</span></span>
<span id="cb97-20"><a href="function-creation.html#cb97-20" tabindex="-1"></a>  <span class="fu">las_to_dem</span>(lases[i], </span>
<span id="cb97-21"><a href="function-creation.html#cb97-21" tabindex="-1"></a>             <span class="at">las_path =</span> las_path,</span>
<span id="cb97-22"><a href="function-creation.html#cb97-22" tabindex="-1"></a>             <span class="at">mnt_path =</span> mnt_path)</span>
<span id="cb97-23"><a href="function-creation.html#cb97-23" tabindex="-1"></a>  </span>
<span id="cb97-24"><a href="function-creation.html#cb97-24" tabindex="-1"></a>}</span>
<span id="cb97-25"><a href="function-creation.html#cb97-25" tabindex="-1"></a></span>
<span id="cb97-26"><a href="function-creation.html#cb97-26" tabindex="-1"></a><span class="co"># close the progressbar</span></span>
<span id="cb97-27"><a href="function-creation.html#cb97-27" tabindex="-1"></a><span class="fu">close</span>(pb)</span>
<span id="cb97-28"><a href="function-creation.html#cb97-28" tabindex="-1"></a><span class="co"># close the cluster</span></span>
<span id="cb97-29"><a href="function-creation.html#cb97-29" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code></pre></div>
<p>When you’re done, clean up the cluster : <em>stopImplicitCluster()</em></p>
</div>
<div id="choses-à-savoir" class="section level2 hasAnchor" number="22.15">
<h2><span class="header-section-number">22.15</span> Choses à savoir<a href="function-creation.html#choses-à-savoir" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Une fct a un environnement propre (ses var sont locales et ne vont pas dans l’envmt de travail): ainsi pas de conflit.
Eviter donc d’utiliser des objets provenant de l’envmt de travail.
Pour cela le mieux est de garder son environnement global tjrs vide (vider tt l’envrmt global : <em>rm(list = ls())</em>)</p></li>
<li><p>On peut définir une fonction à l’intérieur (= <em>fonction interne</em>) d’une autre fonction. Cette fonction sera locale à la fonction dans laquelle elle est définie.</p></li>
</ul>
</div>
<div id="débogage-tips" class="section level2 hasAnchor" number="22.16">
<h2><span class="header-section-number">22.16</span> Débogage tips<a href="function-creation.html#débogage-tips" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Lorsque <em>Browse[1]&gt;</em> s’affiche dans la console, on peut écrire des commandes utilisant l’environnement de la fonction en bug, et donc la travailler.</p></li>
<li><p>Un booléen T/F ne marche pas si des NA existe</p></li>
<li><p>Lorsqu’une fct ne retourne pas le résultat attendu, placer des commandes <em>print</em> à l’intérieur de la fct, afin de suivre les valeurs prises par les différentes variables. On peut même écrire print(1) après la 1ère ligne, print(2) après la 2eme, ainsi de suite pour savoir à quelle ligne se trouve l’erreur.</p></li>
<li><p>Quand ce qui précède ne fonctionne pas, ne reste souvent plus qu’à exécuter manuellement la fonction :</p></li>
<li><p>définir dans l’espace de travail tous les arguments de la fonction,</p></li>
<li><p>puis exécuter le corps de la fonction ligne par ligne.
La vérification du résultat de chaque ligne permet généralement de retrouver la ou les expressions qui causent problème.</p></li>
</ul>
<p>ou</p>
<ul>
<li>masquez avec le « ## » toutes les commandes que vous venez d’éditer ou rajouter, sauf la 1ere, Sauvez, et testez le fichier afin de voir si cette ligne est correcte. Si « source » fonctionne, enlevez le prochain dièse. N’oubliez pas de sauver et de « sourcer » à chaque test.</li>
</ul>
</div>
<div id="où-écrire-ses-fcts" class="section level2 hasAnchor" number="22.17">
<h2><span class="header-section-number">22.17</span> Où écrire ses fcts ?<a href="function-creation.html#où-écrire-ses-fcts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Dans un fichier .R indépendant
<em>nom de fichier = nom de la fonction</em></p>
</div>
<div id="comment-les-utiliser" class="section level2 hasAnchor" number="22.18">
<h2><span class="header-section-number">22.18</span> Comment les utiliser ?<a href="function-creation.html#comment-les-utiliser" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Enregistrer le code de la fct dans l’envmt : <strong>source(“nomfct/file.R”)</strong></p>
</div>
<div id="plusieurs-fonctions-internes---passation-dinfos" class="section level2 hasAnchor" number="22.19">
<h2><span class="header-section-number">22.19</span> Plusieurs fonctions internes - passation d’infos<a href="function-creation.html#plusieurs-fonctions-internes---passation-dinfos" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="function-creation.html#cb98-1" tabindex="-1"></a><span class="do">## Main : fonction englobante</span></span>
<span id="cb98-2"><a href="function-creation.html#cb98-2" tabindex="-1"></a>main <span class="ot">&lt;-</span> <span class="cf">function</span>(inventory){</span>
<span id="cb98-3"><a href="function-creation.html#cb98-3" tabindex="-1"></a>  inventory.volume <span class="ot">&lt;-</span> <span class="fu">getvolume</span>(inventory)</span>
<span id="cb98-4"><a href="function-creation.html#cb98-4" tabindex="-1"></a>  <span class="fu">rm</span>(inventory)</span>
<span id="cb98-5"><a href="function-creation.html#cb98-5" tabindex="-1"></a>  inventory.final <span class="ot">&lt;-</span> <span class="fu">filtervolume</span>(<span class="at">patate =</span> inventory.volume)</span>
<span id="cb98-6"><a href="function-creation.html#cb98-6" tabindex="-1"></a>  <span class="fu">rm</span>(inventory.volume)</span>
<span id="cb98-7"><a href="function-creation.html#cb98-7" tabindex="-1"></a>  <span class="fu">return</span>(inventory.final)</span>
<span id="cb98-8"><a href="function-creation.html#cb98-8" tabindex="-1"></a>}</span>
<span id="cb98-9"><a href="function-creation.html#cb98-9" tabindex="-1"></a></span>
<span id="cb98-10"><a href="function-creation.html#cb98-10" tabindex="-1"></a><span class="do">## Fonctions internes</span></span>
<span id="cb98-11"><a href="function-creation.html#cb98-11" tabindex="-1"></a>getvolume <span class="ot">&lt;-</span> <span class="cf">function</span>(inventory){</span>
<span id="cb98-12"><a href="function-creation.html#cb98-12" tabindex="-1"></a>  inventory <span class="ot">&lt;-</span> inventory <span class="sc">%&gt;%</span> </span>
<span id="cb98-13"><a href="function-creation.html#cb98-13" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">v =</span> <span class="dv">2</span><span class="sc">*</span>d)</span>
<span id="cb98-14"><a href="function-creation.html#cb98-14" tabindex="-1"></a>  <span class="fu">return</span>(inventory)</span>
<span id="cb98-15"><a href="function-creation.html#cb98-15" tabindex="-1"></a>}</span>
<span id="cb98-16"><a href="function-creation.html#cb98-16" tabindex="-1"></a></span>
<span id="cb98-17"><a href="function-creation.html#cb98-17" tabindex="-1"></a>filtervolume <span class="ot">&lt;-</span> <span class="cf">function</span>(patate){</span>
<span id="cb98-18"><a href="function-creation.html#cb98-18" tabindex="-1"></a>  poireau <span class="ot">&lt;-</span> patate <span class="sc">%&gt;%</span> </span>
<span id="cb98-19"><a href="function-creation.html#cb98-19" tabindex="-1"></a>    <span class="fu">filter</span>(v <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb98-20"><a href="function-creation.html#cb98-20" tabindex="-1"></a>  <span class="fu">return</span>(poireau)</span>
<span id="cb98-21"><a href="function-creation.html#cb98-21" tabindex="-1"></a>}</span>
<span id="cb98-22"><a href="function-creation.html#cb98-22" tabindex="-1"></a></span>
<span id="cb98-23"><a href="function-creation.html#cb98-23" tabindex="-1"></a><span class="do">## test</span></span>
<span id="cb98-24"><a href="function-creation.html#cb98-24" tabindex="-1"></a>inventory <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">d =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>))</span>
<span id="cb98-25"><a href="function-creation.html#cb98-25" tabindex="-1"></a><span class="fu">main</span>(inventory)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intégration-continue.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="package-creation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
